﻿<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sina Gait Laboratory</title>
    <meta name="description" content="Demo for the tutorial on how to add an interactive 3D character to a website." />
    <meta name="keywords" content="3d model, three.js, tutorial, interactive, website, web development" />
    <meta name="author" content="Codrops" />
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="css/GUI.css" />
    <link rel="stylesheet" type="text/css" href="css/base.css" />
    <script>document.documentElement.className="js";var supportsCssVars=function(){var e,t=document.createElement("style");return t.innerHTML="root: { --tmp-var: bold; }",document.head.appendChild(t),e=!!(window.CSS&&window.CSS.supports&&window.CSS.supports("font-weight","var(--tmp-var)")),t.parentNode.removeChild(t),e};supportsCssVars()||alert("Please view this demo in a modern browser that supports CSS Variables.");</script>

    <script src="Chart.js"></script>


    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            margin: auto;
            text-align: center;
        }

        div2 {
            text-align: center;
            margin: auto;
        }

        input {
            width: 70px;
        }

        .collapsible {
            background-color: #777;
            color: white;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
        }

            .active, .collapsible:hover {
                background-color: #555;
            }

        .content {
            padding: 0 18px;
            display: none;
            overflow: hidden;
            background-color: #f1f1f1;
        }


        .collapsible_anatomyrecorder {
            background-color: green;
            color: white;
            cursor: pointer;
            padding: 18px;
            width: 100%;
            border: none;
            text-align: left;
            outline: none;
            font-size: 15px;
            text-align: center;
        }

            .active_anatomyrecorder, .collapsible_anatomyrecorder:hover {
                background-color: red;
                text-align: center;
            }

        .content_anatomyrecorder {
            padding: 0 18px;
            display: none;
            overflow: hidden;
            background-color: pink;
            text-align: center;
        }

        .button_anatomyrecorder {
            background-color: #04AA6D;
            border: none;
            color: white;
            padding: 30px 64px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: auto;
            cursor: pointer;
            text-align: center;
        }


        h1_anatomyrecorder {
            font-size: 50px;
            color: white;
            text-align: center;
        }

        .text_anatomyrecorder {
            color: white;
            text-align: center;
        }



        .small_button_anatomyrecorder {
            background-color: #04AA6D;
            border: none;
            color: white;
            padding: 15px 30px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: auto;
            cursor: pointer;
            text-align: center;
        }
    </style>


</head>



<body style="margin:auto; text-align:center; background-color: #95bdfc; " onload="init(); setNormalGaitValues(); ">

    <frame>
        <div class="loading" id="js-loader">
            <div class="loader"></div>
        </div>
        <div class="wrapper">
            <!-- The canvas element is used to draw the 3D scene -->
            <canvas id="c"></canvas>
        </div>

    </frame>
    <frame>


        <h2>Sina Gait Labortory </h2>









        <!--****************************************************************************
        ****************************************************************************
        ****************************************************************************
        ************************ Sina ANAtomy Recorder *****************************
        ****************************************************************************
        ****************************************************************************
        ****************************************************************************
        ****************************************************************************
        -->

        <audio id="bibSoundStart">
            <source src="bs.ogg" type="audio/ogg">
            <source src="bs.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>

        <audio id="bibSoundEnd">
            <source src="be.ogg" type="audio/ogg">
            <source src="be.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>


        <h1_anatomyrecorder id="counter">Sina ANAtomy Recorder</h1_anatomyrecorder>

        <button type="button" class="collapsible_anatomyrecorder">Orientation Monitoring</button>
        <div class="content_anatomyrecorder">
            <p>In this box, the live orientation of your device is being printed.</p>

            <h3 class="text" id="alphaDemo">Alpha</h3><br />
            <h3 class="text" id="betaDemo">Beta</h3><br />
            <h3 class="text" id="gammaDemp">Gamma</h3><br />

        </div>



        <button type="button" class="collapsible_anatomyrecorder">Stand-By Avoider</button>
        <div class="content_anatomyrecorder">
            <p>By playing a video, your device will not stand by.</p>

            <video controls loop>
                <source src="file.mp4" type="video/mp4">
                Your browser does not support the video tag.
            </video>
        </div>


        <button type="button" class="collapsible_anatomyrecorder">Help</button>
        <div class="content_anatomyrecorder">
            <p>Ti record your own movement: 1-Click on the 'Start' button. 2-After that, you have only 10 seconds to place your device in your organ. 3-After 25 seconds, your motion is recorded.</p>
        </div>

        <button type="button" class="collapsible_anatomyrecorder">About This project</button>
        <div class="content">
            <p>This is a scientific project by: Sina Saadati.</p>
        </div>



        <br />
        <br />
        <button style="border-radius:5px;" class="button_anatomyrecorder" type="button" onclick="start();">Start</button>
        <br />





        <br />
        <br />
        <br />





        <button id="resultBox" hidden onclick="drawDiagramAplhas()" type="button" class="collapsible_anatomyrecorder">Results</button>
        <div class="content_anatomyrecorder">



            <button id="box1" onclick="drawDiagramAplhas()" type="button" class="collapsible_anatomyrecorder">Alpha Diagram</button>
            <div class="content_anatomyrecorder">
                <p>In this box, the live orientation of your device is being printed.</p>
                <canvas id="ChartAlphas" style="width:100%;max-width:600px;margin:auto;"></canvas>

            </div>

            <button id="box2" onclick="drawDiagramBetas();" type="button" class="collapsible_anatomyrecorder">Beta Diagram</button>
            <div class="content_anatomyrecorder">
                <p>In this box, the live orientation of your device is being printed.</p>
                <canvas id="ChartBetas" style="width:100%;max-width:600px;margin:auto;"></canvas>

            </div>

            <button id="box3" onclick="drawDiagramGammas();" type="button" class="collapsible_anatomyrecorder">Gamma Diagram</button>
            <div class="content_anatomyrecorder">
                <p>In this box, the live orientation of your device is being printed.</p>
                <canvas id="ChartGammas" style="width:100%;max-width:600px;margin:auto;"></canvas>

            </div>




            <button id="box4" type="button" class="collapsible_anatomyrecorder">Alpha Values</button>
            <div class="content_anatomyrecorder">

                <p class="text" id="resultsAlpha"></p>

            </div>

            <button id="box5" type="button" class="collapsible_anatomyrecorder">Beta Values</button>
            <div class="content_anatomyrecorder">

                <p class="text_anatomyrecorder" id="resultsBeta"></p>

            </div>

            <button id="box6" type="button" class="collapsible_anatomyrecorder">Gamma Values</button>
            <div class="content_anatomyrecorder">

                <p class="text_anatomyrecorder" id="resultsGamma"></p>

            </div>



            <button id="box6" type="button" class="collapsible_anatomyrecorder">Summarize RAW data</button>
            <div class="content_anatomyrecorder">

                <div id="summarizedData"></div>


                <br />
                <button type="button" onclick="setRecorderDataAsThighAngles();" class="small_button_anatomyrecorder">Set as Thigh angles</button>
                <br />
                <button type="button" onclick="setRecorderDataAsLegAngles();" class="small_button_anatomyrecorder">Set as Leg angles</button>
                <br />
                <button type="button" onclick="setRecorderDataAsFeetAngles();" class="small_button_anatomyrecorder">Set as Feet angles</button>
                <br />




            </div>


            <button id="box6" type="button" class="collapsible_anatomyrecorder">Intelligent Doctor</button>
            <div class="content_anatomyrecorder">

                <div id="detectiondemo">To analyze the data using artificial intelligence methods, please use golden account. </div>

            </div>



        </div>




        <br />
        <br />
        <br />



        <!--****************************************************************************
            ****************************************************************************
            ****************************************************************************
            ************************ Sina Gait Simulator *******************************
            ****************************************************************************
            ****************************************************************************
            ****************************************************************************
            ****************************************************************************
            -->


        <br />

        <p>Please indicate the angles of joints during walking:</p>



        <button onclick="setNormalGaitValues();" class="w3-button w3-xlarge w3-teal">Normal Gait</button>
        <button onclick="setPathologicGaitValues1();" class="w3-button w3-xlarge w3-teal">Abnormal gait 1</button>
        <button onclick="setPathologicGaitValues2();" class="w3-button w3-xlarge w3-teal">Abnormal gait 2</button>

        <p>   </p>

        <table style="width: 100%;border-radius: 25px;">
            <colgroup>
                <col span="2" style="background-color: #D6EEEE">
                <col span="3" style="background-color: pink">
            </colgroup>
            <tr>
                <th style="width: 10%;"> Time (%)</th>
                <th style="width: 30%;">Ankle</th>
                <th style="width: 30%;">Knee</th>
                <th style="width: 30%;">Hip</th>
            </tr>

            <tr>
                <td>5</td>
                <td> <div2>Ankle 1:</div2></br><input id="ankle1"><br><br> </td>
                <td> <div2>Knee 1:</div2></br><input type="text" id="knee1"><br><br></td>
                <td> <div2>Hip 1:</div2></br><input type="text" id="hip1"><br><br> </td>
            </tr>

            <tr>
                <td>10</td>
                <td> <div2>Ankle 2:</div2></br><input id="ankle2"><br><br> </td>
                <td> <div2>Knee 2:</div2></br><input type="text" id="knee2"><br><br></td>
                <td> <div2>Hip 2:</div2></br><input type="text" id="hip2"><br><br> </td>
            </tr>

            <tr>
                <td>15</td>
                <td> <div2>Ankle 3:</div2></br><input id="ankle3"><br><br> </td>
                <td> <div2>Knee 3:</div2></br><input type="text" id="knee3"><br><br></td>
                <td> <div2>Hip 3:</div2></br><input type="text" id="hip3"><br><br> </td>
            </tr>

            <tr>
                <td>20</td>
                <td> <div2>Ankle 4:</div2></br><input id="ankle4"><br><br> </td>
                <td> <div2>Knee 4:</div2></br><input type="text" id="knee4"><br><br></td>
                <td> <div2>Hip 4:</div2></br><input type="text" id="hip4"><br><br> </td>
            </tr>

            <tr>
                <td>25</td>
                <td> <div2>Ankle 5:</div2></br><input id="ankle5"><br><br> </td>
                <td> <div2>Knee 5:</div2></br><input type="text" id="knee5"><br><br></td>
                <td> <div2>Hip 5:</div2></br><input type="text" id="hip5"><br><br> </td>
            </tr>

            <tr>
                <td>30</td>
                <td> <div2>Ankle 6:</div2></br><input id="ankle6"><br><br> </td>
                <td> <div2>Knee 6:</div2></br><input type="text" id="knee6"><br><br></td>
                <td> <div2>Hip 6:</div2></br><input type="text" id="hip6"><br><br> </td>
            </tr>

            <tr>
                <td>35</td>
                <td> <div2>Ankle 7:</div2></br><input id="ankle7"><br><br> </td>
                <td> <div2>Knee 7:</div2></br><input type="text" id="knee7"><br><br></td>
                <td> <div2>Hip 7:</div2></br><input type="text" id="hip7"><br><br> </td>
            </tr>

            <tr>
                <td>40</td>
                <td> <div2>Ankle 8:</div2></br><input id="ankle8"><br><br> </td>
                <td> <div2>Knee 8:</div2></br><input type="text" id="knee8"><br><br></td>
                <td> <div2>Hip 8:</div2></br><input type="text" id="hip8"><br><br> </td>
            </tr>

            <tr>
                <td>45</td>
                <td> <div2>Ankle 9:</div2></br><input id="ankle9"><br><br> </td>
                <td> <div2>Knee 9:</div2></br><input type="text" id="knee9"><br><br></td>
                <td> <div2>Hip 9:</div2></br><input type="text" id="hip9"><br><br> </td>
            </tr>

            <tr>
                <td>50</td>
                <td> <div2>Ankle 10:</div2></br><input id="ankle10"><br><br> </td>
                <td> <div2>Knee 10:</div2></br><input type="text" id="knee10"><br><br></td>
                <td> <div2>Hip 10:</div2></br><input type="text" id="hip10"><br><br> </td>
            </tr>

            <tr>
                <td>55</td>
                <td> <div2>Ankle 11:</div2></br><input id="ankle11"><br><br> </td>
                <td> <div2>Knee 11:</div2></br><input type="text" id="knee11"><br><br></td>
                <td> <div2>Hip 11:</div2></br><input type="text" id="hip11"><br><br> </td>
            </tr>

            <tr>
                <td>60</td>
                <td> <div2>Ankle 12:</div2></br><input id="ankle12"><br><br> </td>
                <td> <div2>Knee 12:</div2></br><input type="text" id="knee12"><br><br></td>
                <td> <div2>Hip 12:</div2></br><input type="text" id="hip12"><br><br> </td>
            </tr>

            <tr>
                <td>65</td>
                <td> <div2>Ankle 13:</div2></br><input id="ankle13"><br><br> </td>
                <td> <div2>Knee 13:</div2></br><input type="text" id="knee13"><br><br></td>
                <td> <div2>Hip 13:</div2></br><input type="text" id="hip13"><br><br> </td>
            </tr>

            <tr>
                <td>70</td>
                <td> <div2>Ankle 14:</div2></br><input id="ankle14"><br><br> </td>
                <td> <div2>Knee 14:</div2></br><input type="text" id="knee14"><br><br></td>
                <td> <div2>Hip 14:</div2></br><input type="text" id="hip14"><br><br> </td>
            </tr>

            <tr>
                <td>75</td>
                <td> <div2>Ankle 15:</div2></br><input id="ankle15"><br><br> </td>
                <td> <div2>Knee 15:</div2></br><input type="text" id="knee15"><br><br></td>
                <td> <div2>Hip 15:</div2></br><input type="text" id="hip15"><br><br> </td>
            </tr>

            <tr>
                <td>80</td>
                <td> <div2>Ankle 16:</div2></br><input id="ankle16"><br><br> </td>
                <td> <div2>Knee 16:</div2></br><input type="text" id="knee16"><br><br></td>
                <td> <div2>Hip 16:</div2></br><input type="text" id="hip16"><br><br> </td>
            </tr>

            <tr>
                <td>85</td>
                <td> <div2>Ankle 17:</div2></br><input id="ankle17"><br><br> </td>
                <td> <div2>Knee 17:</div2></br><input type="text" id="knee17"><br><br></td>
                <td> <div2>Hip 17:</div2></br><input type="text" id="hip17"><br><br> </td>
            </tr>

            <tr>
                <td>90</td>
                <td> <div2>Ankle 18:</div2></br><input id="ankle18"><br><br> </td>
                <td> <div2>Knee 18:</div2></br><input type="text" id="knee18"><br><br></td>
                <td> <div2>Hip 18:</div2></br><input type="text" id="hip18"><br><br> </td>
            </tr>

            <tr>
                <td>95</td>
                <td> <div2>Ankle 19:</div2></br><input id="ankle19"><br><br> </td>
                <td> <div2>Knee 19:</div2></br><input type="text" id="knee19"><br><br></td>
                <td> <div2>Hip 19:</div2></br><input type="text" id="hip19"><br><br> </td>
            </tr>

            <tr>
                <td>100</td>
                <td> <div2>Ankle 20:</div2></br><input id="ankle20"><br><br> </td>
                <td> <div2>Knee 20:</div2></br><input type="text" id="knee20"><br><br></td>
                <td> <div2>Hip 20:</div2></br><input type="text" id="hip20"><br><br> </td>
            </tr>


        </table>


        <p>   </p>


        <button style="text-align:center;" onclick="updateCharts();" type="button" class="collapsible">Open Diagrams</button>
        <div class="content">
            <p style="text-align:center;">This chart shows the angle diagram of the hip joint in the sagittal plane during the cycle. The blue diagram is illustrated based on your entered data while green diagram is related to a normal gait cycle.</p>
            <canvas id="myChart1" style="width:100%;max-width:600px;margin:auto;"></canvas>
            <p style="text-align:center;">This chart shows the angle diagram of the knee joint in the sagittal plane during the cycle. The blue diagram is illustrated based on your entered data while green diagram is related to a normal gait cycle.</p>
            <canvas id="myChart2" style="width:100%;max-width:600px;margin:auto;"></canvas>
            <p style="text-align:center;">This chart shows the angle diagram of the ankle joint in the sagittal plane during the cycle. The blue diagram is illustrated based on your entered data while green diagram is related to a normal gait cycle.</p>
            <canvas id="myChart3" style="width:100%;max-width:600px;margin:auto;"></canvas>

            p style="text-align:center;">You can now analize the data, use our proposed artificial intelligence analizers and also utilize our intelligent medic. Click on 'Boots Algorithm' for more.</p>

            <button type="button" class="collapsible" style="text-align:center;">Boots Algorithm</button>
            <div class="content">
                <p>LOCKED!</p>
                <p>Please purchase a golden account.</p>
            </div>

        </div>




        <b>Welcome!</b></br>
        <b>In this program, you can simulate any kind of gait.</b></br>
        <b>Please enter the angles for the lower body joints in the table above.</b></br>
        <b>Then, click the button 'Simulate' to begin the simulation.</b></br>
        <b>This is a scientific project designed and developed by: Sina Saadati.</b></br>
        <b> </b></br>


        <h2>Simulation Bar:</h2>
        <button onclick="turnLeft();" class="w3-button w3-xlarge w3-circle w3-black"><</button>
        <button onclick="startEngine();" class="w3-button w3-xlarge w3-teal">Simulate</button>
        <button onclick="turnRight();" class="w3-button w3-xlarge w3-circle w3-red w3-card-4">></button>

        </br>

        <p> </p>



    </frame>

    <!--

        <span class="action">Click me!</span>

          -->
    <!-- The main Three.js file -->
    <script src='js/three.min.js'></script>
    <!-- This brings in the ability to load custom 3D objects in the .gltf file format. Blender allows the ability to export to this format out the box -->
    <script src='js/GLTFLoader.js'></script>
    <!-- partial -->

    <script>





        ///****************************************************************************
        ///****************************************************************************
        ///****************************************************************************
        ///*********************************Sina ANAtomy Recorder**********************
        ///****************************************************************************
        ///****************************************************************************
        ///****************************************************************************






        function init() {
            window.addEventListener('deviceorientation', function (event) {
                document.getElementById("alphaDemo").innerHTML = "Alpha = " + event.alpha;
                document.getElementById("betaDemo").innerHTML = "Beta = " + event.beta;
                document.getElementById("gammaDemp").innerHTML = "Gamma = " + event.gamma;
            });

            window.addEventListener('deviceorientation', eventHandler);


            var coll = document.getElementsByClassName("collapsible_anatomyrecorder");

            var i;

            for (i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function () {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.display === "block") {
                        content.style.display = "none";
                    } else {
                        content.style.display = "block";
                    }
                });
            }

        }



        let alphaDS = [];
        let betaDS = [];
        let gammaDS = [];


        function start() {
            count10();
            window.setTimeout(count9, 1000);
            window.setTimeout(count8, 2000);
            window.setTimeout(count7, 3000);
            window.setTimeout(count6, 4000);
            window.setTimeout(count5, 5000);
            window.setTimeout(count4, 6000);
            window.setTimeout(count3, 7000);
            window.setTimeout(count2, 8000);
            window.setTimeout(count1, 9000);

            window.setTimeout(startRecording, 10000);
            window.setTimeout(stop, 23000);
        }

        recorder = false;

        function startRecording() {

            alphaDS = [];
            betaDS = [];
            gammaDS = [];

            var x = document.getElementById("bibSoundStart");
            x.play();

            recorder = true;
            document.getElementById("counter").innerHTML = "Sina ANAtomy Recorder";
        }


        function stop() {
            recorder = false;
            printResults();
            document.getElementById("resultBox").hidden = false;

            var x = document.getElementById("bibSoundEnd");
            x.play();
        }




        function eventHandler(event) {
            if (recorder) {
                alphaDS.push(event.alpha);
                betaDS.push(event.beta);
                gammaDS.push(event.gamma);
            }
        }



        function count1() {
            document.getElementById("counter").innerHTML = "1";
        }

        function count2() {
            document.getElementById("counter").innerHTML = "2";
        }

        function count3() {
            document.getElementById("counter").innerHTML = "3";
        }

        function count4() {
            document.getElementById("counter").innerHTML = "4";
        }

        function count5() {
            document.getElementById("counter").innerHTML = "5";
        }

        function count6() {
            document.getElementById("counter").innerHTML = "6";
        }

        function count7() {
            document.getElementById("counter").innerHTML = "7";
        }

        function count8() {
            document.getElementById("counter").innerHTML = "8";
        }

        function count9() {
            document.getElementById("counter").innerHTML = "9";
        }

        function count10() {
            document.getElementById("counter").innerHTML = "10";
        }

        function count0() {
            document.getElementById("counter").innerHTML = " ";
        }



        function printResults() {
            printAlphaResults();
            printBetaResults();
            printGammaResults();

            summarizeRawData();

        }


        function summarizeRawData(){
            raw1 = getMatrixOfSummarizeRawData();
            ttext = "Result = [ " ;
            for (k = 0 ; k < raw1.length ; k++) {
                ttext += raw1[k] + " "  ;
                if(k < ( raw1.length - 1 ) ){
                    ttext +=  ", "  ;
                }
            }
            ttext += " ] "  ; 

            document.getElementById("summarizedData").innerHTML = ttext ;
        }



        function setRecorderDataAsThighAngles(){
            rawData = getMatrixOfSummarizeRawData();

            for( var k = 0 ; k < 20 ; k ++ ){
                elementID = "hip" + String((k+1));
                val = String( rawData[ k ] - 90.0 );
                document.getElementById(elementID).value = val ;
            }
        }



        function setRecorderDataAsLegAngles(){
            rawData = getMatrixOfSummarizeRawData();

            for( var k = 0 ; k < 20 ; k ++ ){
                elementID = "knee" + String((k+1));
                val = String( 90.0 - rawData[ k ]  );
                document.getElementById(elementID).value = val ;
            }
        }



        function setRecorderDataAsFeetAngles(){
            rawData = getMatrixOfSummarizeRawData();

            for( var k = 0 ; k < 20 ; k ++ ){
                elementID = "ankle" + String((k+1));
                val = String( rawData[ k ] - 90.0 );
                document.getElementById(elementID).value = val ;
            }
        }





        function getMatrixOfSummarizeRawData() {
            raw1 = filterGamma1();
            return raw1 ;
        }




        ///function getMatrixOfSummarizeRawData() {
        ///    raw1 = filter1();
        ///    return raw1 ;
        ///}





        function filter1(){
            q = filter2();
            size = q.length ;
            wwww = [] ;

            for(u = 0 ; u < 20 ; u++){
                wwww.push(q[Math.round((u/20)*size)]);
            }

            return wwww;

        }





        function filter2() {
            arr = [] ;
            r = 0;
            for (i = 1 ; i < betaDS.length; i++) {
                if (betaDS[i - 1] < 90 && betaDS[i] > 90) {
                    r = r + 1;
                }
                if(r == 3){
                    arr.push(betaDS[i]);
                }
            }
            return arr;
        }








        function filterGamma1(){
            q = filterGamma2();
            size = q.length ;
            wwww = [] ;

            for(u = 0 ; u < 20 ; u++){
                wwww.push(q[Math.round((u/20)*size)]);
            }

            return wwww;

        }









        function filterGamma2() {
            arr = [] ;
            r = 0;

            for (i = 1 ; i < gammaDS.length - 1 ; i++) {
                y1 = gammaDS[i] ;
                if(gammaDS[i] > 0 && gammaDS[i + 1] < 0){
                    r = r + 1 ;
                }
                if(r == 3){
                    if(y1 < 0.0){
                        y1 = y1 + 180.0 ;
                    }
                    arr.push(y1);
                }
            }
            return arr;
        }







        function printAlphaResults() {
            results = 'Alpha = [ ';
            for (i = 0 ; i < alphaDS.length - 1 ; i++) {
                results += alphaDS[i] + ' , \n';
            }
            results += alphaDS[alphaDS.length - 1] + ' ] \n\n\n';
            document.getElementById("resultsAlpha").innerHTML = results;
        }


        function printBetaResults() {
            results = 'Beta = [ ';
            for (i = 0 ; i < alphaDS.length - 1 ; i++) {
                results += betaDS[i] + ' , \n';
            }
            results += betaDS[alphaDS.length - 1] + ' ] \n';
            document.getElementById("resultsBeta").innerHTML = results;
        }


        function printGammaResults() {
            results = 'Gamma = [ ';
            for (i = 0 ; i < alphaDS.length - 1 ; i++) {
                results += gammaDS[i] + ' , \n';
            }
            results += gammaDS[alphaDS.length - 1] + ' ] \n';
            document.getElementById("resultsGamma").innerHTML = results;
        }



        function drawDiagramAplhas() {

            xValues = makeXs(alphaDS.length);

            new Chart("ChartAlphas", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [{
                        data: alphaDS,
                        borderColor: "red",
                        fill: false
                    }]
                },
                options: {
                    legend: { display: false }
                }
            });
        }



        function drawDiagramBetas() {

            xValues = makeXs(betaDS.length);

            new Chart("ChartBetas", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [{
                        data: betaDS,
                        borderColor: "blue",
                        fill: false
                    }]
                },
                options: {
                    legend: { display: false }
                }
            });
        }



        function drawDiagramGammas() {

            xValues = makeXs(gammaDS.length);

            new Chart("ChartGammas", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [{
                        data: GammaFilter() ,
                        borderColor: "green",
                        fill: false
                    }]
                },
                options: {
                    legend: { display: false }
                }
            });
        }






        function GammaFilter() {
            arr = [] ;

            for (i = 1 ; i < gammaDS.length - 1 ; i++) {
                y1 = gammaDS[i] ;
                if(y1 < 0.0){
                    y1 = y1 + 180.0 ;
                }
                arr.push(y1);
            }
            return arr;
        }







        function makeXs(len) {
            r = [];
            for (i = 0 ; i < len ; i++) {
                r.push(i);
            }
            return r;
        }




        function minimum() {
            r = betaDS[0];
            for (i = 0 ; i < betaDS.length; i++) {
                if (betaDS[i] < r) {
                    r = betaDS[i];
                }
            }
            return r;
        }



        function maximum() {
            r = betaDS[0];
            for (i = 0 ; i < betaDS.length; i++) {
                if (betaDS[i] > r) {
                    r = betaDS[i];
                }
            }
            return r;
        }


        function stepCounter() {
            r = 0;
            for (i = 1 ; i < betaDS.length; i++) {
                if (betaDS[i - 1] < 90 && betaDS[i] > 90) {
                    r = r + 1;
                }
            }
            return r;
        }






        ///****************************************************************************
        ///****************************************************************************
        ///****************************************************************************
        ///*********************************Sina Gait Simulator************************
        ///****************************************************************************
        ///****************************************************************************
        ///****************************************************************************








        // Set our main variables
        let scene,
        renderer,
        camera,
        model, // Our character
        leg,
        hipL,
        kneeL,
        ankleL,
        hipR,
        kneeR,
        ankleR,
        neck, // Reference to the neck bone in the skeleton
        waist, // Reference to the waist bone in the skeleton
        possibleAnims, // Animations found in our file
        mixer, // THREE.js animations mixer
        idle, // Idle, the default state our character returns to
        clock = new THREE.Clock(), // Used for anims, which run to a clock instead of frame rate
        currentlyAnimating = false, // Used to check whether characters neck is being used in another anim
        raycaster = new THREE.Raycaster(), // Used to detect the click on our character
        loaderAnim = document.getElementById('js-loader');


        initSimulator();
        drawTableOfCharts();





        function drawTableOfCharts(){

            var coll = document.getElementsByClassName("collapsible");
            var i;

            for (i = 0; i < coll.length; i++) {
                coll[i].addEventListener("click", function() {
                    this.classList.toggle("active");
                    var content = this.nextElementSibling;
                    if (content.style.display === "block") {
                        content.style.display = "none";
                    } else {
                        content.style.display = "block";
                    }
                });
            }

        }



        function updateCharts(){

            const xValues = [5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100];


            new Chart("myChart1", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [ {
                        data: NormalHipAngles ,
                        borderColor: "green",
                        fill: false
                    }, {
                        data: getEnteredHipAngles() ,
                        borderColor: "blue",
                        fill: false
                    }]
                },
                options: {
                    legend: {display: false}
                }
            });






            new Chart("myChart2", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [ {
                        data: NormalKneeAngles ,
                        borderColor: "green",
                        fill: false
                    }, {
                        data: getEnteredKneeAngles() ,
                        borderColor: "blue",
                        fill: false
                    }]
                },
                options: {
                    legend: {display: false}
                }
            });





            new Chart("myChart3", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [ {
                        data: NormalAnkleAngles ,
                        borderColor: "green",
                        fill: false
                    }, {
                        data: getEnteredAnkleAngles() ,
                        borderColor: "blue",
                        fill: false
                    }]
                },
                options: {
                    legend: {display: false}
                }
            });



        }




        function initSimulator() {

            const MODEL_PATH = 'girl.glb';
            const canvas = document.querySelector('#c');
            const backgroundColor = 0xf1f1f1;

            // Init the scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(backgroundColor);
            scene.fog = new THREE.Fog(backgroundColor, 60, 100);

            // Init the renderer
            renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.shadowMap.enabled = true;
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // Add a camera
            camera = new THREE.PerspectiveCamera(
            50,
            window.innerWidth / window.innerHeight,
            0.1,
            1000);

            camera.position.z = 30;
            camera.position.x = 0;
            camera.position.y = -3;

            let stacy_txt = new THREE.TextureLoader().load('girl.jpg');
            stacy_txt.flipY = false ;

            const stacy_mtl = new THREE.MeshPhongMaterial({
                map: stacy_txt,
                color: 0xffffff,
                skinning: true });



            var loader = new THREE.GLTFLoader();

            function doneload (gltf) {
                model = gltf.scene;
                let fileAnimations = gltf.animations;

                model.traverse(o => {
                    if(o.isBone){
                        console.log(o.name);
            }
            if (o.isMesh) {
                o.castShadow = true;
                o.receiveShadow = true;
                o.material = stacy_mtl;
            }
            // Reference the neck and waist bones
            if (o.isBone && o.name === 'mixamorigNeck') {
                neck = o;
            }
            if (o.isBone && o.name === 'mixamorigSpine') {
                waist = o;
            }


            if (o.isBone && o.name === 'mixamorigLeftUpLeg') {
                leg = o;
                hipL = o ;
            }
            if (o.isBone && o.name === 'mixamorigLeftLeg') {
                kneeL = o ;
            }
            if (o.isBone && o.name === 'mixamorigLeftFoot') {
                ankleL = o ;
            }


            if (o.isBone && o.name === 'mixamorigRightUpLeg') {
                hipR = o ;
            }
            if (o.isBone && o.name === 'mixamorigRightLeg') {
                kneeR = o ;
            }
            if (o.isBone && o.name === 'mixamorigRightFoot') {
                ankleR = o ;
            }

        });

        model.scale.set(7, 7, 7);
        model.position.y = -11;

        scene.add(model);

        loaderAnim.remove();


        model.rotation.y = model_rotation_y ;

        hipL.rotation.y = 0.0 ;
        hipR.rotation.y = 0.0 ;
        hipL.rotation.z = 3.1415 ;
        hipR.rotation.z = 3.1415 ;
        kneeL.rotation.z = 0.0 ;
        kneeR.rotation.z = 0.0 ;
        ankleL.rotation.y = 0.0 ;
        ankleR.rotation.y = 0.0 ;


        }


        function err(){
            console.log("Error") ;
        }


        loader.load( MODEL_PATH, doneload , undefined, err);


        // Add lights
        let hemiLight = new THREE.HemisphereLight(0xffffff, 0xffffff, 0.61);
        hemiLight.position.set(0, 50, 0);
        // Add hemisphere light to scene
        scene.add(hemiLight);

        let d = 8.25;
        let dirLight = new THREE.DirectionalLight(0xffffff, 0.54);
        dirLight.position.set(-8, 12, 8);
        dirLight.castShadow = true ;
        dirLight.shadow.mapSize = new THREE.Vector2(1024, 1024);
        dirLight.shadow.camera.near = 0.1;
        dirLight.shadow.camera.far = 1500;
        dirLight.shadow.camera.left = d * -1;
        dirLight.shadow.camera.right = d;
        dirLight.shadow.camera.top = d;
        dirLight.shadow.camera.bottom = d * -1;
        // Add directional Light to scene
        scene.add(dirLight);


        // Floor
        let floorGeometry = new THREE.PlaneGeometry(5000, 5000, 1, 1);
        let floorMaterial = new THREE.MeshPhongMaterial({
            color: 0xc75f5f,
            shininess: 0 });


        let floor = new THREE.Mesh(floorGeometry, floorMaterial);
        floor.rotation.x = -0.5 * Math.PI;
        floor.receiveShadow = true;
        floor.position.y = -11;
        scene.add(floor);


        update();


        ///const myTimeout01 = setTimeout( startEngine , 5000 );

        }


        function update() {
            if (mixer) {
                mixer.update(clock.getDelta());
            }

            if (resizeRendererToDisplaySize(renderer)) {
                const canvas = renderer.domElement;
                camera.aspect = canvas.clientWidth / canvas.clientHeight;
                camera.updateProjectionMatrix();
            }


            renderer.render(scene, camera);
            requestAnimationFrame(update);
        }

        //update();

        function resizeRendererToDisplaySize(renderer) {
            const canvas = renderer.domElement;
            let width = window.innerWidth;
            let height = window.innerHeight;
            let canvasPixelWidth = canvas.width / window.devicePixelRatio;
            let canvasPixelHeight = canvas.height / window.devicePixelRatio;

            const needResize =
            canvasPixelWidth !== width || canvasPixelHeight !== height;
            if (needResize) {
                renderer.setSize(width, height, false);
            }
            return needResize;
        }



        let model_rotation_y = -3.1415 / 4.0 ;


        function keyListener(event){
            console.log(event.code);
            if(event.code == "ArrowRight"){
                model_rotation_y += 0.02 ;
                model.rotation.y = (model_rotation_y) ;
            }else if(event.code == "ArrowLeft"){
                model_rotation_y -= 0.02 ;
                model.rotation.y = (model_rotation_y) ;
            }
        }

        document.addEventListener('keydown' , keyListener ) ;




        document.addEventListener('mousemove', function (e) {
            var mousecoords = getMousePos(e);
            if (neck && waist) {

                //moveJoint(mousecoords, leg , 50);

                //moveJoint(mousecoords, neck, 50);
                //moveJoint(mousecoords, waist, 30);
            }
        });

        function getMousePos(e) {
            return { x: e.clientX, y: e.clientY };
        }

        function moveJoint(mouse, joint, degreeLimit) {
            let degrees = getMouseDegrees(mouse.x, mouse.y, degreeLimit);
            joint.rotation.y = THREE.Math.degToRad(degrees.x);
            joint.rotation.x = THREE.Math.degToRad(degrees.y);
            console.log(joint.rotation.x);
        }


        function getMouseDegrees(x, y, degreeLimit) {
            let dx = 0,
            dy = 0,
            xdiff,
            xPercentage,
            ydiff,
            yPercentage;

            let w = { x: window.innerWidth, y: window.innerHeight };

            // Left (Rotates neck left between 0 and -degreeLimit)
            // 1. If cursor is in the left half of screen
            if (x <= w.x / 2) {
                // 2. Get the difference between middle of screen and cursor position
                xdiff = w.x / 2 - x;
                // 3. Find the percentage of that difference (percentage toward edge of screen)
                xPercentage = xdiff / (w.x / 2) * 100;
                // 4. Convert that to a percentage of the maximum rotation we allow for the neck
                dx = degreeLimit * xPercentage / 100 * -1;
            }

            // Right (Rotates neck right between 0 and degreeLimit)
            if (x >= w.x / 2) {
                xdiff = x - w.x / 2;
                xPercentage = xdiff / (w.x / 2) * 100;
                dx = degreeLimit * xPercentage / 100;
            }
            // Up (Rotates neck up between 0 and -degreeLimit)
            if (y <= w.y / 2) {
                ydiff = w.y / 2 - y;
                yPercentage = ydiff / (w.y / 2) * 100;
                // Note that I cut degreeLimit in half when she looks up
                dy = degreeLimit * 0.5 * yPercentage / 100 * -1;
            }
            // Down (Rotates neck down between 0 and degreeLimit)
            if (y >= w.y / 2) {
                ydiff = y - w.y / 2;
                yPercentage = ydiff / (w.y / 2) * 100;
                dy = degreeLimit * yPercentage / 100;
            }
            return { x: dx, y: dy };
        }




        let hipAngles = [-28,-25,-21,-16,-10,-2,5,10,15,19,19,17,11,1,-8,-17,-24,-29,-29,-29] ;
        let kneeAngles = [-1,-7,-12,-12,-10,-6,0,2,-0,5,-10,-19,-29,-40,-48,-45,-40,-25,-12,-5];
        let ankleAngles = [0,-4,-4,-1,2,3,5,7,8,7,-1,-14,-22,-21,-12,-6,0,3,6,7];



        let NormalHipAngles = [-28,-25,-21,-16,-10,-2,5,10,15,19,19,17,11,1,-8,-17,-24,-29,-29,-29] ;
        let NormalKneeAngles = [-1,-7,-12,-12,-10,-6,0,2,-0,5,-10,-19,-29,-40,-48,-45,-40,-25,-12,-5];
        let NormalAnkleAngles = [0,-4,-4,-1,2,3,5,7,8,7,-1,-14,-22,-21,-12,-6,0,3,6,7];



        let time = 00 ;
        let periodSteps = 20 ;




        function startEngine(){
            setAngleValues();
            var id = setInterval( Engine , 100); // Engine of the software
        }


        function Engine(){
            //moveJoints();
            //computeVelocity();
            time++;
            moveJoints_UsingAnglesForm(); // Only for testing aims.
        }

        ///var id = setInterval( Engine , 100); // Moved to the end of init function.


        function moveJoints_UsingAnglesForm(){
            let TL = time % periodSteps ;
            hip_left_angle = hipAngles[TL] ;
            knee_left_angle = kneeAngles[TL] ;
            ankle_left_angle = ankleAngles[TL] ;

            let TR = (time + 10) % periodSteps ;
            hip_right_angle = hipAngles[TR] ;
            knee_right_angle = kneeAngles[TR] ;
            ankle_right_angle = ankleAngles[TR] ;

            hipL.rotation.x = THREE.Math.degToRad(  hip_left_angle  );
            kneeL.rotation.x = THREE.Math.degToRad(   knee_left_angle  );
            ankleL.rotation.x = (1.0820971833965258) + THREE.Math.degToRad(  ankle_left_angle  );

            hipR.rotation.x = THREE.Math.degToRad(hip_right_angle);
            kneeR.rotation.x = THREE.Math.degToRad(knee_right_angle);
            ankleR.rotation.x = (1.0820971833965258) + THREE.Math.degToRad(ankle_right_angle);

        }




        let timeInSeconds = 0 ;
        function MyClock(){
            //console.log("Time = " + timeInSeconds) ;
            timeInSeconds ++ ;
        }

        var id = setInterval( MyClock , 1000);



        function turnRight(){
            model_rotation_y += 0.08 ;
            model.rotation.y = (model_rotation_y) ;

        }


        function turnLeft(){
            model_rotation_y -= 0.08 ;
            model.rotation.y = (model_rotation_y) ;
        }



        function setNormalGaitValues(){
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("ankle" + i).value  = NormalAnkleAngles[ i - 1 ] ;
            }
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("knee" + i).value  = NormalKneeAngles[ i - 1 ] ;
            }
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("hip" + i).value  = NormalHipAngles[ i - 1 ] ;
            }
        }


        let abnormalGait1_ankle = [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ] ;
        let abnormalGait1_knee  = [-1,-7,-12,-12,-10,-6,0,2,-0,5,-10,-19,-29,-40,-48,-45,-40,-25,-12,-5] ;
        let abnormalGait1_hip   =  [-28,-25,-21,-16,-10,-2,5,10,15,19,19,17,11,1,-8,-17,-24,-29,-29,-29] ;


        function setPathologicGaitValues1(){
            alert("In this case, the ankle has not movement. This phenomenon can be seen when a person is wearing boots.");
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("ankle" + i).value  = abnormalGait1_ankle[ i - 1 ] ;
            }
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("knee" + i).value  = abnormalGait1_knee[ i - 1 ] ;
            }
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("hip" + i).value  = abnormalGait1_hip[ i - 1 ] ;
            }
        }




        let abnormalGait2_ankle = [ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ] ;
        let abnormalGait2_knee  = [-1,-3,-6,-6,-5,-3,0,1,2,0,-5,-9,-14,-20,-24,-22,-20,-12,-6,-2] ;
        let abnormalGait2_hip   =  [-14,-12,-10,-8,-5,0,2,5,7,9,9,8,5,1,-4,-8,-12,-14,-14,-14] ;


        function setPathologicGaitValues2(){
            alert("In this case, the patient is walking slowly and carefully. This phenomenon can be seen in patients suffering from Parkinson disease.");
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("ankle" + i).value  = abnormalGait2_ankle[ i - 1 ] ;
            }
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("knee" + i).value  = abnormalGait2_knee[ i - 1 ] ;
            }
            for(i = 1 ; i <= 20 ; i ++ ){
                document.getElementById("hip" + i).value  = abnormalGait2_hip[ i - 1 ] ;
            }
        }







        function setAngleValues(){
            for(i = 1 ; i <= 20 ; i ++ ){
                ankleAngles[ i - 1 ] = parseFloat(document.getElementById("ankle" + i).value) ;
            }
            for(i = 1 ; i <= 20 ; i ++ ){
                kneeAngles[ i - 1 ] = parseFloat(document.getElementById("knee" + i).value) ;
            }
            for(i = 1 ; i <= 20 ; i ++ ){
                hipAngles[ i - 1 ] = parseFloat(document.getElementById("hip" + i).value) ;
            }
        }



        function getEnteredAnkleAngles(){
            r = [] ;
            for(i = 1 ; i <= 20 ; i ++ ){
                r.push(document.getElementById("ankle" + i).value) ;
            }
            return r ;
        }

        function getEnteredKneeAngles(){
            r = [] ;
            for(i = 1 ; i <= 20 ; i ++ ){
                r.push(document.getElementById("knee" + i).value) ;
            }
            return r ;
        }

        function getEnteredHipAngles(){
            r = [] ;
            for(i = 1 ; i <= 20 ; i ++ ){
                r.push(document.getElementById("hip" + i).value) ;
            }
            return r ;
        }










    </script></script>
</body>
</html>
